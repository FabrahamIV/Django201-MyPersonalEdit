{% load static %}
<nav class="navbar navbar-expand-lg bg-body-tertiary bg-gradient">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">
      <img src="{% static 'feed/svg/F.svg' %}" alt="Logo" width="35" height="auto" class="d-inline-block align-text-top">
      Fabraham
    </a>
    <div class="d-flex gap-1 align-items-center">
      {% if user.is_authenticated %}
        <a href="{% url 'account_logout' %}" class="btn btn-danger p-2">Sign Out</a>
      {% else %}
        <a href="{% url 'account_login' %}" class="btn btn-primary p-2">Sign In</a>
      {% endif %}
      <button class="btn" id="darkModeToggle">
          <img src="{% static 'feed/svg/toggle_off.svg' %}" alt="Toggle" width="auto" height="1rem" id="toggleIcon" class="d-inline-block align-text-top">
      </button>
    </div>
  </div>
</nav>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const toggleButton = document.getElementById('darkModeToggle');
    const toggleIcon = document.getElementById('toggleIcon');
    const htmlElement = document.documentElement;

    if (!toggleButton || !toggleIcon) {
      console.error('Dark mode toggle elements not found');
      return;
    }

    const currentTheme = localStorage.getItem('theme') || 'light';
    htmlElement.setAttribute('data-bs-theme', currentTheme);
    updateIcon(currentTheme);

    toggleButton.addEventListener('click', () => {
      document.body.classList.add('theme-transition');
      const newTheme = htmlElement.getAttribute('data-bs-theme') === 'dark' ? 'light' : 'dark';
      htmlElement.setAttribute('data-bs-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateIcon(newTheme);

      setTimeout(() => {
        document.body.classList.remove('theme-transition');
      }, 400);
    });

    function updateIcon(theme) {
      toggleIcon.src = theme === 'dark'
        ? "{% static 'feed/svg/toggle_off.svg' %}"
        : "{% static 'feed/svg/toggle_on.svg' %}";
    }
  });
</script>